<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Kdefy Trade - Plataforma de anÃ¡lise de mercado de aÃ§Ãµes em tempo real com grÃ¡ficos interativos e conteÃºdo educacional para investidores.">
  <meta name="keywords" content="investimentos, aÃ§Ãµes, bolsa de valores, trading, PETR4, mercado financeiro">
  <meta name="author" content="Kdefy Trade">
  
  <title>Kdefy Trade - AnÃ¡lise de Mercado em Tempo Real</title>
  
  <link rel="icon" id="dynamicFavicon" type="image/png">
  
  <style>
    :root {
      --color-primary: #0b2545;
      --color-primary-light: #134073;
      --color-accent: #4db8ff;
      --color-accent-hover: #3aa0e8;
      --color-bg-main: #f9faff;
      --color-bg-card: #ffffff;
      --color-text-primary: #0b2545;
      --color-text-secondary: #4a5568;
      --color-text-light: #ffffff;
      --color-border: #dce3f0;
      --color-success: #26a69a;
      --color-danger: #ef5350;
      --sidebar-width: 300px;
      --header-height: 70px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--color-bg-main);
      color: var(--color-text-primary);
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    #sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
      color: var(--color-text-light);
      padding: 30px 25px;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    #sidebar::-webkit-scrollbar {
      width: 6px;
    }

    #sidebar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    #sidebar::-webkit-scrollbar-thumb {
      background: var(--color-accent);
      border-radius: 3px;
    }

    .sidebar-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(77, 184, 255, 0.3);
    }

    .sidebar-header h2 {
      color: var(--color-accent);
      font-size: 1.5em;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .sidebar-header .subtitle {
      font-size: 0.85em;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 300;
    }

    .info-section {
      margin-bottom: 25px;
      padding: 18px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border-left: 3px solid var(--color-accent);
      transition: var(--transition);
    }

    .info-section:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(3px);
    }

    .info-section h3 {
      color: var(--color-accent);
      font-size: 1.1em;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .info-section p {
      font-size: 0.9em;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.9);
    }

    .example-box {
      background: rgba(77, 184, 255, 0.1);
      padding: 12px;
      border-radius: 6px;
      margin-top: 8px;
      font-size: 0.85em;
      border: 1px solid rgba(77, 184, 255, 0.2);
    }

    .tip-badge {
      display: inline-block;
      background: var(--color-accent);
      color: var(--color-primary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: 600;
      margin-bottom: 8px;
    }

    /* Main content */
    #main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background-color: var(--color-bg-main);
    }

    header {
      width: 100%;
      height: var(--header-height);
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
      color: var(--color-text-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header-title {
      font-size: 1.8em;
      font-weight: 700;
      letter-spacing: 1.5px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-title::before {
      content: '';
      width: 8px;
      height: 40px;
      background: var(--color-accent);
      border-radius: 4px;
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 0.9em;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--color-success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    #chart-container {
      flex-grow: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: var(--color-bg-card);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .chart-title {
      font-size: 1.3em;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .chart-meta {
      display: flex;
      gap: 20px;
      font-size: 0.9em;
      color: var(--color-text-secondary);
    }

    #chart {
      flex-grow: 1;
      background-color: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: var(--color-text-secondary);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--color-border);
      border-top-color: var(--color-accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsividade */
    @media (max-width: 968px) {
      body {
        flex-direction: column;
      }

      #sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
      }

      .header-info {
        display: none;
      }
    }
  </style>
</head>
<body>
  <aside id="sidebar">
    <div class="sidebar-header">
      <h2>Kdefy Trade</h2>
      <p class="subtitle">EducaÃ§Ã£o Financeira</p>
    </div>

    <section class="info-section">
      <h3>ðŸ’¡ O que Ã© investir?</h3>
      <p>Investir Ã© colocar seu dinheiro para trabalhar e gerar mais dinheiro ao longo do tempo. No mercado de aÃ§Ãµes, vocÃª compra uma parte (aÃ§Ã£o) de uma empresa listada na bolsa de valores.</p>
    </section>

    <section class="info-section">
      <h3>ðŸ“ˆ Como funciona o mercado?</h3>
      <p>Cada aÃ§Ã£o representa uma fraÃ§Ã£o de uma empresa. Quando o preÃ§o da aÃ§Ã£o sobe, vocÃª pode lucrar vendendo por mais do que pagou. O preÃ§o varia conforme oferta e demanda.</p>
    </section>

    <section class="info-section">
      <h3>ðŸ’° Exemplo PrÃ¡tico</h3>
      <div class="example-box">
        VocÃª compra 10 aÃ§Ãµes da Petrobras (PETR4) a R$ 30,00.<br>
        Se o preÃ§o subir para R$ 33,00, vocÃª ganha R$ 3,00 por aÃ§Ã£o.<br>
        <strong>Lucro total: R$ 30,00 (10 Ã— R$ 3,00)</strong>
      </div>
    </section>

    <section class="info-section">
      <span class="tip-badge">DICA IMPORTANTE</span>
      <p>Invista com consciÃªncia e conhecimento. Estude o negÃ³cio, diversifique sua carteira e tenha paciÃªncia para ver seus investimentos crescerem.</p>
    </section>
  </aside>

  <main id="main">
    <header>
      <div class="header-title">KDEFY TRADE</div>
      <div class="header-info">
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span>Ao Vivo</span>
        </div>
        <span id="current-time"></span>
      </div>
    </header>

    <div id="chart-container">
      <div class="chart-header">
        <div class="chart-title">PETR4.SA - Petrobras PN</div>
        <div class="chart-meta">
          <span>ðŸ“Š Intervalo: 1 minuto</span>
          <span>ðŸ“… PerÃ­odo: Hoje</span>
        </div>
      </div>
      <div id="chart" style="position: relative;">
        <div id="loading">
          <div class="spinner"></div>
          <p>Carregando dados do mercado...</p>
        </div>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script>
    // Favicon dinÃ¢mico
    (function createFavicon() {
      const canvas = document.createElement('canvas');
      canvas.width = 64;
      canvas.height = 64;
      const ctx = canvas.getContext('2d');
      
      // Gradiente de fundo
      const gradient = ctx.createLinearGradient(0, 0, 64, 64);
      gradient.addColorStop(0, '#0b2545');
      gradient.addColorStop(1, '#134073');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 64, 64);
      
      // Letra K
      ctx.fillStyle = '#4db8ff';
      ctx.font = 'bold 44px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('K', 32, 34);
      
      document.getElementById('dynamicFavicon').href = canvas.toDataURL();
    })();

    // Atualizar horÃ¡rio
    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('pt-BR');
      const timeEl = document.getElementById('current-time');
      if (timeEl) timeEl.textContent = timeStr;
    }
    updateTime();
    setInterval(updateTime, 1000);

    // Criar grÃ¡fico
    const chartElement = document.getElementById('chart');
    const loadingElement = document.getElementById('loading');
    
    const chart = LightweightCharts.createChart(chartElement, {
      layout: { 
        background: { color: '#ffffff' }, 
        textColor: '#0b2545' 
      },
      grid: { 
        vertLines: { color: '#f0f3f7' }, 
        horzLines: { color: '#f0f3f7' } 
      },
      crosshair: { 
        mode: LightweightCharts.CrosshairMode.Normal 
      },
      rightPriceScale: { 
        borderVisible: false,
        scaleMargins: {
          top: 0.1,
          bottom: 0.1,
        },
      },
      timeScale: { 
        borderVisible: false,
        timeVisible: true,
        secondsVisible: false,
      },
      handleScroll: {
        mouseWheel: true,
        pressedMouseMove: true,
      },
      handleScale: {
        axisPressedMouseMove: true,
        mouseWheel: true,
        pinch: true,
      },
    });

    const candleSeries = chart.addCandlestickSeries({
      upColor: '#26a69a',
      downColor: '#ef5350',
      borderDownColor: '#ef5350',
      borderUpColor: '#26a69a',
      wickDownColor: '#ef5350',
      wickUpColor: '#26a69a',
    });

    // FunÃ§Ã£o para buscar dados do Yahoo Finance
    async function fetchCandles() {
      const proxy = "https://api.allorigins.win/get?url=";
      const url = encodeURIComponent("https://query1.finance.yahoo.com/v8/finance/chart/PETR4.SA?interval=1m&range=1d");
      
      try {
        const res = await fetch(proxy + url);
        const data = await res.json();
        const body = JSON.parse(data.contents);
        const result = body.chart.result[0];
        const timestamps = result.timestamp;
        const prices = result.indicators.quote[0];
        
        const candles = timestamps
          .map((t, i) => ({
            time: t,
            open: prices.open[i],
            high: prices.high[i],
            low: prices.low[i],
            close: prices.close[i]
          }))
          .filter(c => c.open && c.high && c.low && c.close);
        
        if (candles.length > 0) {
          candleSeries.setData(candles);
          loadingElement.style.display = 'none';
          chart.timeScale().fitContent();
        }
      } catch (err) {
        console.error("Erro ao buscar dados:", err);
        loadingElement.innerHTML = '<div class="spinner"></div><p style="color: #ef5350;">Erro ao carregar dados. Tentando novamente...</p>';
      }
    }

    // Ajustar tamanho do grÃ¡fico
    function resizeChart() {
      chart.applyOptions({ 
        width: chartElement.clientWidth,
        height: chartElement.clientHeight 
      });
    }

    window.addEventListener('resize', resizeChart);
    resizeChart();

    // Iniciar busca de dados
    fetchCandles();
    setInterval(fetchCandles, 60000); // Atualiza a cada 1 minuto
  </script>
</body>
</html>
