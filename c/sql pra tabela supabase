-- Criar tabela de grupos pendentes
CREATE TABLE pending_groups (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT NOT NULL,
    whatsapp_link TEXT NOT NULL,
    category TEXT,
    image_url TEXT,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW()
);

-- Criar tabela de grupos aprovados
CREATE TABLE approved_groups (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT NOT NULL,
    whatsapp_link TEXT NOT NULL,
    category TEXT,
    image_url TEXT,
    status TEXT DEFAULT 'approved',
    approved_at TIMESTAMP DEFAULT NOW(),
    created_at TIMESTAMP
);

-- Habilitar RLS (Row Level Security)
ALTER TABLE pending_groups ENABLE ROW LEVEL SECURITY;
ALTER TABLE approved_groups ENABLE ROW LEVEL SECURITY;

-- Políticas RLS: Grupos aprovados são públicos para leitura
CREATE POLICY "Grupos aprovados são públicos" 
ON approved_groups FOR SELECT 
USING (true);

-- Políticas RLS: Qualquer um pode enviar grupos
CREATE POLICY "Qualquer um pode enviar grupos" 
ON pending_groups FOR INSERT 
WITH CHECK (true);

-- Políticas RLS: Apenas admin pode ler grupos pendentes
CREATE POLICY "Admin pode ler grupos pendentes" 
ON pending_groups FOR SELECT 
USING (true);

-- Políticas RLS: Apenas admin pode deletar grupos pendentes
CREATE POLICY "Admin pode deletar grupos pendentes" 
ON pending_groups FOR DELETE 
USING (true);
